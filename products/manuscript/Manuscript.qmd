---
title: "Impact of IPTp Regimen on Pregnancy Outcomes in a Malaria-Endemic Setting"
bibliography: "../../assets/dataanalysis-references.bib"
csl: "../../assets/american-journal-of-epidemiology.csl"

format:
  docx:
    toc: false
    number-sections: true
    output-file: "Manuscript.docx"  

project:
  output-dir: "C:/Users/ajose35/Desktop/MADA-course/Joseph-MADA-project/products/manuscript"

execute:
  echo: false
  warning: false
  message: false
---




```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.show="hold"}
# Load Required Libraries for Data Handling, Visualization, and Analysis

library(here)             # Manage file paths
library(tidyverse)        # Core data wrangling and visualization (dplyr, ggplot2, readr, etc.)
library(janitor)          # Clean and format column names
library(skimr)            # Quick data summaries
library(gtsummary)        # Create summary tables
library(gt)               # Format tables
library(knitr)            # R Markdown table formatting
library(kableExtra)       # Enhanced table customization for kable output
library(ggpubr)           # Publication-ready plots
library(Amelia)           # Visualize missing data
library(pwr)              # Perform power analyses
library(DiagrammeR)       # Create flowcharts and diagrams
library(survival)         # Survival analysis functions
library(survminer)        # Visualize survival analysis results
library(flextable)        # Create tables for Word output
library(webshot2)         # Capture screenshots for HTML widgets in non-HTML outputs
library(logistf)          # Penalized logistic regression (Firth’s method)
library(ggeffects)
library(car)
library(broom)

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.show="hold"}
# Data Import & Initial Inspection 
# load the Dataset
PROMO_Data <- read_csv(here("data", "raw-data", "PROMO_Data.csv"))


promo_data_clean <- read.csv(here("data", "clean", "PROMO_Data_clean.csv"))
```

**Authors**

-   Asmith Joseph$^{1*}$ (ORCID: 0009-0004-6875-0868)

**Author affiliations**

1.  College of Public Health, University of Georgia, Athens, GA, USA.

$\land$ Corresponding author: asmith.joseph\@uga.edu

$\dagger$ Disclaimer: The opinions expressed in this article are the author's own and don't reflect their employer.

{{< pagebreak >}}

# Summary/Abstract

*Write a summary of your project.*

{{< pagebreak >}}

# Introduction
## General Background Information
Malaria remains a major public health challenge worldwide, particularly in Sub-Saharan Africa, where the disease disproportionately affects vulnerable populations. Caused by Plasmodium parasites transmitted through the bite of infected Anopheles mosquitoes, malaria accounted for an estimated 249 million cases globally in 2022, marking an increase of five million cases compared to the previous year. Uganda alone reported over 597,000 malaria cases during this period, reflecting the country's substantial malaria burden (World Health Organization, 2023; Talapko et al., 2019). Pregnant women represent one of the most vulnerable groups to malaria infection, facing an increased risk of severe clinical symptoms and poor pregnancy outcomes. Malaria during pregnancy has been associated with a range of adverse outcomes, including miscarriage, fetal loss, preterm birth, low birth weight, and neonatal mortality (Chua et al., 2021).

Efforts to mitigate the impact of malaria in pregnancy have centered on preventive strategies such as the use of insecticide-treated bed nets (ITNs) and chemoprophylaxis through intermittent preventive treatment during pregnancy (IPTp). Two widely used IPTp regimens are sulfadoxine-pyrimethamine (SP) and dihydroartemisinin-piperaquine (DP). While these preventive measures have shown significant benefits in reducing the risk of malaria-related complications, the effectiveness of these regimens may not be uniform across all contexts. In particular, emerging evidence suggests that the choice of IPTp regimen may influence how malaria episodes affect pregnancy outcomes. However, this potential effect modification remains underexplored in current literature. Additionally, maternal characteristics such as gravidity—the number of times a woman has been pregnant—may also play a role in shaping birth outcomes. Prior research has suggested that previous pregnancy experience may offer protective benefits against adverse outcomes, possibly due to improved physiological adaptation or better health-seeking behavior.

This study addresses two research questions. First, it examines whether the type of IPTp regimen modifies the association between malaria episode frequency and adverse birth outcomes in Ugandan pregnant women. Preliminary analyses suggest a potential interaction between malaria episodes and the SP regimen, indicating that the impact of malaria may differ by treatment. Second, the study investigates whether increased gravidity reduces the risk of adverse birth outcomes among younger pregnant women under 25 years. Early findings point to a protective effect of prior pregnancies in this subgroup. By addressing these questions, this study aims to clarify how preventive treatment strategies and maternal reproductive history influence birth outcomes in malaria-endemic settings. The results may inform targeted interventions to improve maternal and neonatal health in Uganda and similar contexts


# Methods
This study analyzed data from a double-blind randomized controlled trial conducted in Uganda, obtained from ClinEpiDB (Release #24, August 30, 2022). The trial evaluated IPTp with either sulfadoxine-pyrimethamine (SP) or dihydroartemisinin-piperaquine (DP) among HIV-uninfected pregnant women. The dataset comprised 782 observations, including maternal, pregnancy, and infant health information. Multiple births were recorded separately, and variable definitions adhered to original trial protocols.

The analysis focused on two primary objectives: (1) to assess whether the IPTp regimen modifies the association between malaria episode frequency and adverse birth outcomes (preterm birth, low birth weight, and stillbirth), and (2) to evaluate whether increased gravidity is associated with lower risk of adverse outcomes among women under 25 years.

Data preparation and analysis were performed using R. Date fields were standardized, and categorical variables were coded as factors. Variables with more than 20% missing data were excluded; those with lower missingness were retained and imputed where appropriate. Descriptive statistics and visual inspection were used to assess data integrity.

For the first research question, multivariable logistic regression models were fitted to examine the association between malaria episodes and adverse outcomes, including an interaction term for IPTp regimen. Covariates included maternal age, gravidity, and socioeconomic status. Predicted probabilities were calculated to facilitate interpretation of interaction effects.

For the second question, a subgroup analysis restricted to women under 25 years assessed the association between gravidity and adverse birth outcomes, using logistic regression and adjusting for relevant covariates. Gravidity was treated as a continuous variable, and sensitivity analyses were performed to assess robustness.

All statistical analyses were conducted using the most recent version of R (version 4.3.2).



# Statistical analysis
## Exploratory/Descriptive analyses
Descriptive analyses were conducted to summarize key maternal and clinical characteristics, including maternal age, gravidity, treatment assignment (SP or DP), and malaria episode frequency. Standard summary statistics were used for continuous variables, and proportions were reported for categorical variables. Distributions were visually assessed to identify potential outliers, and missing data were handled through imputation or exclusion based on the extent of missingness.

For the first research question, we evaluated whether the IPTp regimen modified the association between malaria episode frequency and adverse birth outcomes (preterm birth, low birth weight, and stillbirth). Multivariable logistic regression models were fitted, including an interaction term between malaria episodes and IPTp regimen. Models were adjusted for potential confounders, including maternal age, gravidity, and socioeconomic status. Predicted probabilities were estimated to facilitate interpretation of interaction effects.

For the second research question, we conducted a subgroup analysis among pregnant women under 25 years of age to assess the association between gravidity and adverse birth outcomes. Logistic regression models were used, adjusting for relevant covariates, including maternal age, malaria episode frequency, and treatment regimen. Gravidity was treated as a continuous variable.



&nbsp;
&nbsp;



**Table 1: Baseline Characteristics of Study Participants by IPTp Treatment Arm**

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Create table data
table_data <- tribble(
  ~Characteristic,                           ~Subcategory,               ~`DP (N=4121)`,       ~`SP (N=3701)`,
  "Age (years)",                             "",                         "25.0 (5.0)",         "25.0 (4.9)",
  "Gestational Age (weeks)",                 "",                         "15.24 (1.97)",       "14.97 (1.94)",
  "Maternal Education Level (%)",            "",                         "",                   "",
  "",                                        "Primary",                  "262 (66.7%)",        "258 (66.4%)",
  "",                                        "Tertiary",                 "65 (16.5%)",         "61 (15.7%)",
  "",                                        "University",               "66 (16.8%)",         "70 (18.0%)",
  "Gravidity",                               "",                         "",                   "",
  "",                                        "1",                        "91 (22%)",           "56 (15%)",
  "",                                        "2–3",                      "167 (41%)",          "166 (45%)",
  "",                                        "≥4",                       "154 (37%)",          "148 (40%)",
  "Parity",                                  "",                         "",                   "",
  "",                                        "0",                        "79 (19%)",           "77 (21%)",
  "",                                        "1–2",                      "175 (42%)",          "158 (43%)",
  "",                                        "≥3",                       "158 (38%)",          "135 (36%)",
  "Total Malaria Episodes",                  "",                         "",                   "",
  "",                                        "1",                        "245 (59%)",          "216 (58%)",
  "",                                        "2–3",                      "146 (35%)",          "127 (34%)",
  "",                                        "≥4",                       "21 (5.1%)",          "27 (7.3%)",
  "Total Malaria Episodes During Pregnancy", "",                         "",                   "",
  "",                                        "1",                        "179 (43%)",          "165 (45%)",
  "",                                        "2–3",                      "138 (33%)",          "120 (32%)",
  "",                                        "≥4",                       "95 (23%)",           "85 (23%)",
  "Malaria Infection Rate During Pregnancy", "",                         "1.01 (0.58)",        "1.05 (0.58)",
  "Placental Malaria (Rogerson Criteria)",   "",                         "75 (18%)",           "72 (19%)",
  "Preterm Births Count",                    "",                         "",                   "",
  "",                                        "1",                        "391 (95%)",          "348 (94%)",
  "",                                        "2",                        "21 (5.1%)",          "22 (5.9%)",
  "Stillbirth bin",                          "",                         "37 (9.0%)",          "50 (14%)",
  "Birthweight",                             "",                         "2.79 (0.64)",        "2.81 (0.62)",
  "History of Previous Malaria Episodes (%)", "",                        "40 (10%)",           "35 (9%)"
)

kable(
  table_data,
  format = "pandoc",
  caption = ""
) %>% 
  kable_styling(full_width = FALSE, position = "center")

```


&nbsp;
&nbsp;


**Figure 1: Distribution of Total Malaria Episodes by IPTp Treatment Arm**

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)

ggplot(promo_data_clean, aes(x = total_malaria_episodes, fill = study_arm)) +
  geom_histogram(binwidth = 1, alpha = 0.6, position = "dodge") +
  labs(title = "",
       x = "Total Malaria Episodes",
       y = "Frequency",
       fill = "Treatment Arm") +
  theme_minimal()
```


&nbsp;
&nbsp;


**Table 2: Outcome Measures and Malaria Exposure Variables Stratified by IPTp Regimen**

```{r,  echo=FALSE, message=FALSE, warning=FALSE}
# Load necessary libraries
library(dplyr)
library(gtsummary)
library(here)

# Read in the cleaned data (if not already read)
promo_data_clean <- read.csv(here("data", "clean", "PROMO_Data_clean.csv"))

# Recode variables as needed for outcomes analysis:
promo_data_clean <- promo_data_clean %>%
  mutate(
    # Create a composite adverse outcome variable: 1 if any of preterm birth, stillbirth, or low birth weight (<2.5 kg) occurs
    low_birth_weight = ifelse(birth_weight < 2.5, 1, 0),
    adverse_birth_outcome = ifelse(preterm_births_count > 0 | stillbirth_bin == 1 | low_birth_weight == 1, 1, 0),
    
    # Recode Preterm Births Count: combine 0 and 1 as "1", and 2 as "2"
    PretermBirths_cat = case_when(
      preterm_births_count %in% c(0, 1) ~ "1",
      preterm_births_count == 2 ~ "2"
    ),
    PretermBirths_cat = factor(PretermBirths_cat, levels = c("1", "2"))
  )

# Create Table Z: Outcome Variables by IPTp Treatment Arm with p-values
table_outcomes <- promo_data_clean %>%
  dplyr::select(
    study_arm,
    `Malaria Infection Rate During Pregnancy` = malaria_infection_rate_during_pregnancy,
    `Placental Malaria (Rogerson Criteria)` = placental_malaria_by_rogerson_criteria,
    `Preterm Births Count` = PretermBirths_cat,
    `Stillbirth bin` = stillbirth_bin,
    `Birthweight` = birth_weight,
    `Composite Adverse Outcome` = adverse_birth_outcome
  ) %>%
  tbl_summary(
    by = study_arm,
    missing = "no",
    statistic = list(
      all_continuous() ~ "{mean} ({sd})",
      all_categorical() ~ "{n} ({p}%)"
    )
  ) %>%
  add_p() %>%
  modify_header(label = "") %>%
  modify_caption("")

# Print Table Z
table_outcomes
```



&nbsp;
&nbsp;



**Figure 2: Differential Impact of IPTp Treatment on the Relationship Between Malaria Episodes and Adverse Birth Outcomes**

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Create the composite adverse outcome variable
promo_data_clean <- promo_data_clean %>%
  mutate(
    low_birth_weight = ifelse(birth_weight < 2.5, 1, 0),
    adverse_birth_outcome = ifelse(preterm_births_count > 0 | stillbirth_bin == 1 | low_birth_weight == 1, 1, 0)
  )

# Fit the interaction model (ensuring that adverse_birth_outcome now exists)
model_interaction <- glm(adverse_birth_outcome ~ total_malaria_episodes * study_arm + 
                           age_at_enrollment_years + gravidity + education_level,
                         family = binomial(link = "logit"),
                         data = promo_data_clean)

# Generate predicted probabilities over the range of total malaria episodes by study arm
pred <- ggeffect(model_interaction, terms = c("total_malaria_episodes [all]", "study_arm"))

# Plot the predicted probabilities
interaction_plot <- ggplot(pred, aes(x = x, y = predicted, color = group)) +
  geom_line(size = 1.2) +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high, fill = group), alpha = 0.2, color = NA) +
  labs(title = "",
       x = "Total Malaria Episodes",
       y = "Predicted Probability of Adverse Outcome",
       color = "Treatment Arm",
       fill = "Treatment Arm") +
  theme_minimal()

interaction_plot
```


{{< pagebreak >}}





# Results

## Basic statistical analysis

Baseline characteristics were similar between IPTp treatment arms, with comparable age, gestational age at enrollment, education, gravidity, and parity distributions (Table 1). Although overall malaria exposure measures were similar, the stillbirth rate was significantly higher in the SP arm compared to DP (14% vs. 9%; p = 0.044) (Table 2). 

In our multivariable logistic regression analysis—adjusting for maternal age, gravidity, and education—the main effects of total malaria episodes (OR = 0.88, 95% CI: 0.75–1.03, p = 0.121) and treatment arm (OR = 0.69, 95% CI: 0.44–1.08, p = 0.102) were not significant. However, adding an interaction term between total malaria episodes and treatment arm significantly improved model fit (ΔDeviance = 10.11, p = 0.00148), with the interaction itself reaching significance (OR = 1.47, 95% CI: 1.16–1.88, p = 0.002). Notably, higher gravidity was protective (OR = 0.89, 95% CI: 0.80–0.98, p = 0.023), underscoring the potential benefit of prior pregnancy experience. Sensitivity analyses confirmed that these findings were robust, and model diagnostics (VIFs < 2) indicated no concerning multicollinearity. Collectively, these results suggest that the impact of malaria exposure on adverse birth outcomes is modified by the IPTp regimen, highlighting the importance of tailoring preventive strategies based on maternal risk profiles.

&nbsp;
&nbsp;


**Table 3: Interaction Between Malaria Exposure and IPTp Treatment Arm in Predicting Adverse Birth Outcomes**

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#library(broom)
library(dplyr)
library(knitr)
library(kableExtra)
library(here)

# Tidy the model output with exponentiated coefficients (odds ratios)
tidy_model <- tidy(model_interaction, exponentiate = TRUE, conf.int = TRUE)

# Remove the intercept row and recode variable names using case_when()
tidy_model_filtered <- tidy_model %>%
  filter(term != "(Intercept)") %>%
  mutate(
    term = case_when(
      term == "total_malaria_episodes" ~ "Total Malaria Episodes",
      term == "study_armSP" ~ "Treatment Arm (SP)",
      term == "age_at_enrollment_years" ~ "Age at Enrollment (years)",
      term == "gravidity" ~ "Gravidity",
      term == "education_levelSecondary" ~ "Secondary Education",
      term == "education_levelTertiary" ~ "Tertiary Education",
      term == "education_levelUniversity" ~ "University Education",
      term == "total_malaria_episodes:study_armSP" ~ "Interaction: Malaria Episodes × SP",
      TRUE ~ term
    )
  )

# Round key values for clarity
tidy_model_filtered <- tidy_model_filtered %>%
  mutate(
    estimate = round(estimate, 2),
    std.error = round(std.error, 2),
    statistic = round(statistic, 2),
    p.value = round(p.value, 3),
    conf.low = round(conf.low, 2),
    conf.high = round(conf.high, 2)
  )

# Render the table with a blank header for the first column
kable(
  tidy_model_filtered,
  format = "pandoc",
  caption = "",
  col.names = c("", "Odds Ratio", "Std. Error", "z value", "p-value", "95% CI Lower", "95% CI Upper")
) %>% 
  kable_styling(full_width = FALSE, position = "center")

```



&nbsp;
&nbsp;




**Table 4:  Regression Diagnostics for IPTp Treatment Effect**
```{r, echo=FALSE, message=FALSE, warning=FALSE}


# Read in the cleaned data (ensure adverse_birth_outcome is defined as needed)
promo_data_clean <- read.csv(here("data", "clean", "PROMO_Data_clean.csv"))

# Create composite adverse outcome if not already defined
promo_data_clean <- promo_data_clean %>%
  mutate(
    low_birth_weight = ifelse(birth_weight < 2.5, 1, 0),
    adverse_birth_outcome = ifelse(preterm_births_count > 0 | stillbirth_bin == 1 | low_birth_weight == 1, 1, 0)
  )

# Fit Model 1 (without interaction)
model1 <- glm(adverse_birth_outcome ~ total_malaria_episodes + study_arm +
                age_at_enrollment_years + gravidity + education_level,
              family = binomial(link = "logit"), data = promo_data_clean)

# Fit Model 2 (with interaction)
model2 <- glm(adverse_birth_outcome ~ total_malaria_episodes * study_arm +
                age_at_enrollment_years + gravidity + education_level,
              family = binomial(link = "logit"), data = promo_data_clean)

# Generate Analysis of Deviance Table (Likelihood Ratio Test)
lrt <- anova(model1, model2, test = "LRT")
lrt_df <- as.data.frame(lrt)
lrt_df$Model <- c("No Interaction", "With Interaction")
lrt_df <- lrt_df %>% 
  select(Model, `Resid. Df`, `Resid. Dev`, Df, Deviance, `Pr(>Chi)`)
colnames(lrt_df) <- c("Model", "Residual Df", "Residual Dev", "Df", "Deviance", "p-value")

# Render Table X: Likelihood Ratio Test
kable(
  lrt_df,
  format = "pandoc",
  caption = ""
) %>% 
  kable_styling(full_width = FALSE, position = "center")

# Compute Variance Inflation Factors (VIF) for Model 2 (with interaction)
vif_vals <- vif(model2)
vif_df <- as.data.frame(vif_vals)
vif_df$Variable <- rownames(vif_vals)
vif_df <- vif_df %>% rename(`Df (VIF)` = Df)
vif_df <- vif_df %>% 
  select(Variable, GVIF, `Df (VIF)`, `GVIF^(1/(2*Df))`) %>%
  mutate(
    Variable = case_when(
      Variable == "total_malaria_episodes" ~ "Total Malaria Episodes",
      Variable == "study_arm" ~ "Treatment Arm",
      Variable == "age_at_enrollment_years" ~ "Age at Enrollment",
      Variable == "gravidity" ~ "Gravidity",
      Variable == "education_level" ~ "Education Level",
      Variable == "total_malaria_episodes:study_arm" ~ "Interaction: Malaria Episodes × SP",
      TRUE ~ Variable
    )
  )

# Render Table Y: VIF Diagnostics
kable(
  vif_df,
  format = "pandoc",
  caption = ""
) %>% 
  kable_styling(full_width = FALSE, position = "center")

```





&nbsp;
&nbsp;












**Table 5: Evaluating Effect Modification by IPTp Treatment on Malaria-Related Adverse Birth Outcomes Through Model Comparison**

```{r, echo=FALSE, message=FALSE, warning=FALSE}
knitr::include_graphics("C:/Users/ajose35/Desktop/MADA-course/Joseph-MADA-project/Images/Table- Comparing Models .png")

```




&nbsp;
&nbsp;









## Full analysis

*Use one or several suitable statistical/machine learning methods to analyze your data and to produce meaningful figures, tables, etc. This might again be code that is best placed in one or several separate R scripts that need to be well documented. You want the code to produce figures and data ready for display as tables, and save those. Then you load them here.*

{{< pagebreak >}}

# Discussion

## Summary and Interpretation

*Summarize what you did, what you found and what it means.*

## Strengths and Limitations

*Discuss what you perceive as strengths and limitations of your analysis.*

## Conclusions

*What are the main take-home messages?*

*Include citations in your Rmd file using bibtex, the list of references will automatically be placed at the end*

This paper [@leek2015] discusses types of analyses.

These papers [@mckay2020; @mckay2020a] are good examples of papers published using a fully reproducible setup similar to the one shown in this template.

Note that this cited reference will show up at the end of the document, the reference formatting is determined by the CSL file specified in the YAML header. Many more style files for almost any journal [are available](https://www.zotero.org/styles). You also specify the location of your bibtex reference file in the YAML. You can call your reference file anything you like.

{{< pagebreak >}}

# References
