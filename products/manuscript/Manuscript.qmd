---
title: "Evaluating the Impact of Malaria Episodes and Preventive Treatment Regimens on Pregnancy Outcomes among Ugandan Women"
bibliography: "../../assets/dataanalysis-references.bib"
csl: "../../assets/american-journal-of-epidemiology.csl"

format:
  docx:
    toc: false
    number-sections: true
    output-file: "Manuscript.docx"  

project:
  output-dir: "C:/Users/ajose35/Desktop/MADA-course/Joseph-MADA-project/products/manuscript"

execute:
  echo: false
  warning: false
  message: false
---




```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.show="hold"}
# Load Required Libraries for Data Handling, Visualization, and Analysis

library(here)             # Manage file paths
library(tidyverse)        # Core data wrangling and visualization (dplyr, ggplot2, readr, etc.)
library(janitor)          # Clean and format column names
library(skimr)            # Quick data summaries
library(gtsummary)        # Create summary tables
library(gt)               # Format tables
library(knitr)            # R Markdown table formatting
library(kableExtra)       # Enhanced table customization for kable output
library(ggpubr)           # Publication-ready plots
library(Amelia)           # Visualize missing data
library(pwr)              # Perform power analyses
library(DiagrammeR)       # Create flowcharts and diagrams
library(survival)         # Survival analysis functions
library(survminer)        # Visualize survival analysis results
library(flextable)        # Create tables for Word output
library(webshot2)         # Capture screenshots for HTML widgets in non-HTML outputs
library(logistf)          # Penalized logistic regression (Firth’s method)

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.show="hold"}
# Data Import & Initial Inspection 
# load the Dataset
PROMO_Data <- read_csv(here("data", "raw-data", "PROMO_Data.csv"))


promo_data_clean <- read.csv(here("data", "clean", "PROMO_Data_clean.csv"))
```

**Authors**

-   Asmith Joseph$^{1*}$ (ORCID: 0009-0004-6875-0868)

**Author affiliations**

1.  College of Public Health, University of Georgia, Athens, GA, USA.

$\land$ Corresponding author: asmith.joseph\@uga.edu

$\dagger$ Disclaimer: The opinions expressed in this article are the author's own and don't reflect their employer.

{{< pagebreak >}}

# Summary/Abstract

*Write a summary of your project.*

{{< pagebreak >}}

# Introduction
## General Background Information
Malaria is a life-threatening disease caused by Plasmodium parasites, which are transmitted to humans through the bite of an infected female Anopheles mosquito (Talapko et al., 2019). According to the World Health Organization, in 2022, approximately 249 million malaria cases were reported across 85 endemic countries—an increase of 5 million cases compared to 2021. Notably, Uganda alone contributed more than 597,000 cases during that period (WHO, 2023). Despite significant efforts in prevention and treatment, malaria remains a major global health challenge.

Vulnerable groups such as pregnant women, children, and immunocompromised individuals are at the highest risk, and Africa continues to bear the heaviest burden of this disease. Pregnant women with malaria tend to experience more severe clinical symptoms and poorer outcomes, including heightened risks of miscarriage, fetal loss, premature birth, low birth weight in newborns, and neonatal death (Caroline Lin Lin Chua et al., 2021). A multifaceted approach incorporating insecticide-treated bed nets (ITNs) and chemoprevention strategies has proven effective in mitigating the adverse health outcomes associated with malaria during pregnancy. Despite this progress, a 2017 report reveals that only 22% of pregnant women in Sub-Saharan Africa received an entire course of IPTp (Bauserman et al., 2019), underscoring a significant disparity in treatment access. Addressing this issue, the study seeks to: (a) examine the association between the frequency of malaria episodes during pregnancy and adverse birth outcomes, such as preterm birth and stillbirth; (b) assess whether infants born to mothers treated with DP are less likely to experience low birth weight compared to those treated with SP; and (c) explore the relationship between placental malaria and adverse birth outcomes, including preterm birth and low birth weight.




# Methods
The dataset used in this study was obtained from ClinEpiDB (Release #24, August 30, 2022) and originates from a double-blind randomized controlled trial evaluating monthly intermittent preventive treatment of malaria (IPTp) with sulfadoxine-pyrimethamine (SP) or dihydroartemisinin-piperaquine (DP) in HIV-uninfected pregnant women. Comprising 782 observations, the dataset captures detailed information on maternal health, pregnancy outcomes, and infant variables—with separate records maintained for each infant in cases of multiple births. Detailed metadata and documentation were accessed directly, ensuring clear definitions of variable protocols.

The objective of this study is to examine the relationship between malaria exposure, treatment regimens, and adverse pregnancy outcomes. Specifically, we investigate whether an increased number of malaria episodes is associated with higher rates of preterm birth and stillbirth, and whether the DP regimen reduces these episodes compared to SP. We hypothesize that more malaria episodes increase the risk of adverse outcomes (Hypothesis 1) and that DP treatment results in fewer episodes than SP (Hypothesis 2). Additionally, the study assesses infant health outcomes by testing if infants born to DP-treated mothers have a lower incidence of low birth weight (Hypothesis 3) and if neonatal mortality rates differ between treatment groups (Hypothesis 4). Finally, we explore whether placental malaria is associated with adverse birth outcomes, such as preterm birth and low birth weight (Hypothesis 5).

Data were imported into R using standardized, rigorously tested functions to ensure accurate transfer. During import, date fields were converted to Date objects and categorical variables to factors. An initial inspection using functions like str() and summary(), alongside visual tools, confirmed data integrity and proper formatting. Missing data were systematically assessed; variables with more than 20% missing values were excluded, while those with less than 20% missing data were retained and imputed as necessary. 


# Statistical analysis
## Exploratory/Descriptive analyses
We conducted initial descriptive analyses to characterize key demographic and clinical features, including maternal age, parity, treatment allocation (SP versus DP), and the frequency of malaria episodes. Standard summary statistics and visualizations (e.g., histograms and box plots) were used to assess variable distributions and identify potential outliers, while missing data were evaluated and managed through imputation or exclusion as appropriate.

To examine maternal health outcomes, we used logistic regression to assess the association between the number of malaria episodes and adverse outcomes (preterm birth and stillbirth), adjusting for maternal age, parity, and socioeconomic status. We further compared malaria episode frequencies between treatment groups using Poisson or negative binomial regression models.

For infant health outcomes, we employed chi-square tests to initially compare the proportions of low birth weight infants between treatment groups, followed by logistic regression to adjust for maternal nutrition, gestational age, and other relevant factors. Neonatal mortality was similarly evaluated.

Lastly, we used logistic regression to explore the relationship between placental malaria and adverse birth outcomes (preterm birth and low birth weight), also comparing its prevalence between the SP and DP groups while adjusting for confounders.

&nbsp;
&nbsp;



**Table 1. Baseline Characteristics of IPTp Trial Participants**
```{r, echo=FALSE, message=FALSE, warning=FALSE}

# Create table data
table_data <- tribble(
  ~Characteristic, ~Subcategory, ~`Monthly SP (n=391)`, ~`Monthly DP (n=391)`,
  "Age, years", "", "23 (19–27)", "23 (19–27)",
  "Gestational Age at Enrollment (weeks)", "", "15.4 (13.3–17.6)", "15.0 (13.4–17.1)",
  "", "12–16", "66 (17%)", "62 (15.8%)",
  "", "17–20", "164 (42.2%)", "197 (50.1%)",
  "", "21–24", "133 (34.2%)", "118 (30%)",
  "Gravidity", "", "1.2 (0.9–1.7)", "1.1 (0.8–1.6)",
  "", "1", "102 (26%)", "95 (24%)",
  "", "2–3", "180 (46%)", "190 (49%)",
  "", "≥4", "109 (28%)", "106 (27%)",
  "Parity", "", "2.43 (1.67)", "2.43 (1.65)",
  "", "0", "140 (36%)", "145 (37%)",
  "", "1–2", "170 (44%)", "165 (42%)",
  "", "≥3", "81 (20%)", "81 (21%)",
  "Total Malaria Episodes (mean (SD))", "", "1.06 (1.03)", "0.98 (0.95)",
  "Maternal Nutritional Status/BMI (mean (SD))", "", "22.5 (3.2)", "22.8 (3.1)",
  "History of Previous Malaria Episodes (%)", "", "40 (10%)", "35 (9%)",
  "Maternal Education Level (%)", "", "", "",
  "", "A and O Level", "194 (49.4%)", "187 (48.1%)",
  "", "Primary", "68 (17.3%)", "71 (18.3%)",
  "", "Tertiary", "65 (16.5%)", "61 (15.7%)",
  "", "University", "66 (16.8%)", "70 (18.0%)"
)

kable(
  table_data,
  format = "pandoc",
  caption =
) %>%
  kable_styling(full_width = FALSE, position = "center")


```





&nbsp;
&nbsp;








**Figure 1: Distribution of Total Malaria Episodes**
```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.show="hold"}
# Create a histogram of total malaria episodes
ggplot(data = promo_data_clean, aes(x = total_malaria_episodes)) +
  geom_histogram(binwidth = 1, fill = "skyblue", color = "black") +
  labs(
    title =,
    x = "Total Malaria Episodes",
    y = "Count"
  )
```

{{< pagebreak >}}





# Results

## Basic statistical analysis
**Table 2: Association Between Malaria Episodes and Risk of Preterm Birth**
```{r, echo=FALSE, message=FALSE, warning=FALSE}

table_preterm_pars_clean <- tribble(
  ~Variable, ~`Adjusted Odds Ratio (aOR)`, ~`95% CI Lower`, ~`95% CI Upper`, ~`p-value`,
  "Total malaria episodes during pregnancy", 1.04, 0.95, 1.14, 0.401,
  "Age at enrollment (years)", 0.99, 0.96, 1.03, 0.697,
  "Gravidity", 0.91, 0.82, 1.02, 0.106,
  "Parity", 1.17, 1.05, 1.30, 0.005,
  "Hypertension", 0.89, 0.65, 1.22, 0.463,
  "Diabetes mellitus", 1.22, 0.88, 1.69, 0.237
)

# Display table with consistent styling
kable(
  table_preterm_pars_clean,
  format = "pandoc",
  caption = "",
  col.names = c("", "Adjusted Odds Ratio (aOR)", "95% CI Lower", "95% CI Upper", "p-value")
) %>%
  kable_styling(full_width = FALSE, position = "center")

```



&nbsp;
&nbsp;



**Table 3: Association Between Malaria Episodes and Risk of Stillbirth**
```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.show="hold"}
# Ensure the logistf package is loaded
library(logistf)

# Optional: Check that required variables exist in the dataset
required_vars <- c("stillbirth_bin", "total_malaria_episodes_during_pregnancy", 
                   "age_at_enrollment_years", "gravidity", "parity", 
                   "hypertension", "diabetes_mellitus")
if(!all(required_vars %in% names(promo_data_clean))) {
  missing_vars <- required_vars[!required_vars %in% names(promo_data_clean)]
  stop("The following required variables are missing in promo_data_clean: ", paste(missing_vars, collapse=", "))
}

# Run parsimonious stillbirth model
model_stillbirth_pars <- logistf::logistf(
  stillbirth_bin ~ total_malaria_episodes_during_pregnancy +
    age_at_enrollment_years + gravidity + parity +
    hypertension + diabetes_mellitus,
  data = promo_data_clean
)


# Extract and format results
table_stillbirth_pars <- data.frame(
  Variable = names(model_stillbirth_pars$coefficients),
  `Adjusted Odds Ratio (aOR)` = round(exp(model_stillbirth_pars$coefficients), 2),
  `95% CI Lower` = round(exp(model_stillbirth_pars$ci.lower), 2),
  `95% CI Upper` = round(exp(model_stillbirth_pars$ci.upper), 2),
  `p-value` = signif(model_stillbirth_pars$prob, 3)
)

# Remove the intercept row
table_stillbirth_pars <- table_stillbirth_pars[table_stillbirth_pars$Variable != "(Intercept)", ]

# Map raw variable names to clean, reader-friendly labels
variable_labels <- c(
  "total_malaria_episodes_during_pregnancy" = "Total malaria episodes during pregnancy",
  "age_at_enrollment_years" = "Age at enrollment (years)",
  "gravidity" = "Gravidity",
  "parity" = "Parity",
  "hypertensionYes" = "Hypertension",
  "diabetes_mellitusYes" = "Diabetes mellitus"
)

# Replace raw names with neat labels; replace any NA (i.e., unmapped) with blank
table_stillbirth_pars$Variable <- variable_labels[table_stillbirth_pars$Variable]
table_stillbirth_pars$Variable[is.na(table_stillbirth_pars$Variable)] <- ""
rownames(table_stillbirth_pars) <- NULL

# Display table using kable with pandoc format
kable(
  table_stillbirth_pars,
  format = "pandoc",
  caption = "",
  col.names = c("", "Adjusted Odds Ratio (aOR)", "95% CI Lower", "95% CI Upper", "p-value")
) %>%
  kable_styling(full_width = FALSE, position = "center")

```


&nbsp;
&nbsp;



**Association between Malaria Episodes and Adverse Birth Outcomes**
A total of 782 pregnant women were followed in our study, and we began with the hypothesis that a higher frequency of malaria episodes during pregnancy might lead to poorer birth outcomes. To explore this, we first employed logistic regression to assess the relationship with preterm birth. Contrary to our initial expectations, the analysis revealed that an increase in malaria episodes was not associated with a higher risk of preterm delivery (adjusted odds ratio [aOR]: 1.04; 95% CI: 0.95–1.14; p = 0.401; Table 4a). We then refined our approach by using a penalized Firth logistic regression model, which is particularly useful when dealing with rare events or small subgroups. This model too showed no significant link between the number of malaria episodes and stillbirth (aOR: 0.96; 95% CI: 0.83–1.10; p = 0.559; Table 4b). These findings suggest that the story is more complex than a simple linear relationship—factors such as maternal age, gravidity, or hypertension did not appear to drive these outcomes either, prompting us to consider that other biological or environmental influences might be at play.

**Effect of Treatment Arm on Malaria Episode Incidence**
Subsequent analyses focused on whether the type of preventive treatment influenced the occurrence of malaria episodes. Two treatment arms—dihydroartemisinin-piperaquine (DP) and sulfadoxine-pyrimethamine (SP)—were compared using a Poisson regression model, with adjustments for age, gravidity, and education level. The analysis indicated that the incidence of malaria episodes did not differ significantly between the groups (incidence rate ratio [IRR]: 1.02; 95% CI: 0.92–1.12; p = 0.756; Table 4c). These findings suggest that, despite differences in treatment regimens, the overall frequency of malaria episodes remains similar, implying that variations in treatment strategy may have a limited effect on malaria episode incidence in this study population.




&nbsp;
&nbsp;

**Table 4:Incidence Rate Ratios for Malaria Episode Occurrence among Pregnant Women**
```{r}
# Create a data frame with refined variable names
table_model_refined <- data.frame(
  Variable = c("Intercept", 
               "Treatment Arm (SP vs. DP)", 
               "Age at Enrollment (years)", 
               "Gravidity", 
               "Education Level: Secondary", 
               "Education Level: Tertiary", 
               "Education Level: University"),
  IRR = c(1.6081682, 1.0552044, 0.9942737, 1.0095680, 0.9884423, 0.8900707, 1.0363703),
  `95% CI Lower` = c(1.1297705, 0.9382987, 0.9825662, 0.9675647, 0.8348897, 0.7505115, 0.8805393),
  `95% CI Upper` = c(2.280714, 1.186523, 1.006133, 1.053391, 1.170522, 1.055600, 1.220799),
  `p-value` = c(0.008021017, 0.369364418, 0.342231948, 0.660449862, 0.892661838, 0.180547176, 0.668035030)
)

# Remove the intercept row if not required for presentation
table_model_refined <- table_model_refined[table_model_refined$Variable != "Intercept", ]

# Render the table using knitr::kable without row numbers
library(knitr)
kable(
  table_model_refined,
  format = "pandoc",
  caption = "",
  col.names = c("", "IRR", "95% CI Lower", "95% CI Upper", "p-value"),
  row.names = FALSE
)

```



## Full analysis

*Use one or several suitable statistical/machine learning methods to analyze your data and to produce meaningful figures, tables, etc. This might again be code that is best placed in one or several separate R scripts that need to be well documented. You want the code to produce figures and data ready for display as tables, and save those. Then you load them here.*

{{< pagebreak >}}

# Discussion

## Summary and Interpretation

*Summarize what you did, what you found and what it means.*

## Strengths and Limitations

*Discuss what you perceive as strengths and limitations of your analysis.*

## Conclusions

*What are the main take-home messages?*

*Include citations in your Rmd file using bibtex, the list of references will automatically be placed at the end*

This paper [@leek2015] discusses types of analyses.

These papers [@mckay2020; @mckay2020a] are good examples of papers published using a fully reproducible setup similar to the one shown in this template.

Note that this cited reference will show up at the end of the document, the reference formatting is determined by the CSL file specified in the YAML header. Many more style files for almost any journal [are available](https://www.zotero.org/styles). You also specify the location of your bibtex reference file in the YAML. You can call your reference file anything you like.

{{< pagebreak >}}

# References
